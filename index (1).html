<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quiz Leaderboard</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0F0A1E;
    --surface: #1A1030;
    --card: #221540;
    --border: #2E1D56;
    --gold:    #FF6B35;
    --silver:  #C44DFF;
    --bronze:  #FF3D77;
    --gold-bg:    rgba(255,107,53,0.12);
    --silver-bg:  rgba(196,77,255,0.12);
    --bronze-bg:  rgba(255,61,119,0.12);
    --accent: #FF6B35;
    --text: #F0EAF8;
    --muted: #7A6A9A;
    --tag-bg: rgba(255,255,255,0.07);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Nunito', sans-serif;
    min-height: 100vh;
    padding-bottom: 80px;
    position: relative;
    overflow-x: hidden;
  }

  /* Background blobs */
  body::before {
    content: '';
    position: fixed;
    top: -120px; right: -120px;
    width: 480px; height: 480px;
    background: radial-gradient(circle, rgba(196,77,255,0.18) 0%, transparent 70%);
    pointer-events: none;
    z-index: 0;
  }
  body::after {
    content: '';
    position: fixed;
    bottom: -100px; left: -100px;
    width: 400px; height: 400px;
    background: radial-gradient(circle, rgba(255,61,119,0.15) 0%, transparent 70%);
    pointer-events: none;
    z-index: 0;
  }

  .container {
    max-width: 620px;
    margin: 0 auto;
    padding: 48px 18px 0;
    position: relative;
    z-index: 1;
  }

  /* Meta tags row */
  .meta-row {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 22px;
  }

  .tag {
    background: var(--tag-bg);
    border: 1px solid var(--border);
    border-radius: 100px;
    padding: 5px 14px;
    font-size: 12px;
    font-weight: 600;
    letter-spacing: 0.5px;
    color: var(--muted);
    display: inline-flex;
    align-items: center;
    gap: 6px;
  }

  .tag span {
    color: var(--text);
    font-weight: 800;
  }

  /* Title */
  .title-block {
    margin-bottom: 36px;
  }

  h1 {
    font-family: 'Syne', sans-serif;
    font-size: clamp(2.4rem, 10vw, 3.6rem);
    font-weight: 800;
    letter-spacing: -1px;
    line-height: 1;
    background: linear-gradient(135deg, #FF6B35 0%, #FF3D77 40%, #C44DFF 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .title-sub {
    margin-top: 6px;
    font-size: 13px;
    color: var(--muted);
    letter-spacing: 2px;
    text-transform: uppercase;
    font-weight: 600;
  }

  /* Top 3 */
  .top3 {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-bottom: 10px;
  }

  .medal-card {
    display: flex;
    align-items: center;
    border-radius: 12px;
    padding: 18px 18px;
    border: 1px solid;
    opacity: 0;
    animation: popIn 0.45s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    position: relative;
    overflow: hidden;
  }

  .medal-card::before {
    content: '';
    position: absolute;
    inset: 0;
    opacity: 0.06;
    background: linear-gradient(135deg, #fff 0%, transparent 60%);
    pointer-events: none;
  }

  .medal-card.gold   { background: var(--gold-bg);   border-color: rgba(255,107,53,0.45); }
  .medal-card.silver { background: var(--silver-bg); border-color: rgba(196,77,255,0.45); }
  .medal-card.bronze { background: var(--bronze-bg); border-color: rgba(255,61,119,0.45); }

  .medal-card:nth-child(1) { animation-delay: 0.05s; }
  .medal-card:nth-child(2) { animation-delay: 0.14s; }
  .medal-card:nth-child(3) { animation-delay: 0.23s; }

  .medal-emoji {
    font-size: 26px;
    margin-right: 14px;
    flex-shrink: 0;
    filter: drop-shadow(0 2px 6px rgba(0,0,0,0.4));
  }

  .medal-info {
    flex: 1;
    min-width: 0;
  }

  .medal-name {
    font-size: 18px;
    font-weight: 800;
    letter-spacing: 0.2px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    color: #fff;
  }

  .medal-rank-label {
    font-size: 11px;
    font-weight: 700;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    margin-top: 2px;
  }

  .gold   .medal-rank-label { color: var(--gold); }
  .silver .medal-rank-label { color: var(--silver); }
  .bronze .medal-rank-label { color: var(--bronze); }

  .medal-score {
    font-family: 'Syne', sans-serif;
    font-size: 26px;
    font-weight: 800;
    flex-shrink: 0;
    margin-left: 12px;
  }

  .gold   .medal-score { color: var(--gold); }
  .silver .medal-score { color: var(--silver); }
  .bronze .medal-score { color: var(--bronze); }

  /* Rest of list */
  .rest-list {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
  }

  .rest-row {
    display: flex;
    align-items: center;
    padding: 13px 18px;
    border-bottom: 1px solid rgba(46,29,86,0.8);
    opacity: 0;
    animation: fadeUp 0.4s ease forwards;
    transition: background 0.15s;
  }

  .rest-row:last-child { border-bottom: none; }
  .rest-row:hover { background: rgba(255,255,255,0.03); }

  .rest-rank {
    font-family: 'Syne', sans-serif;
    font-size: 13px;
    color: var(--muted);
    width: 30px;
    flex-shrink: 0;
    margin-right: 14px;
    text-align: center;
    font-weight: 700;
  }

  .rest-name {
    flex: 1;
    font-size: 15px;
    font-weight: 700;
    color: var(--text);
    min-width: 0;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .rest-score {
    font-family: 'Syne', sans-serif;
    font-size: 16px;
    font-weight: 700;
    color: var(--muted);
    flex-shrink: 0;
    margin-left: 12px;
  }

  /* Status */
  .status {
    text-align: center;
    padding: 80px 20px;
    color: var(--muted);
    font-size: 15px;
    line-height: 2;
  }

  .status .emoji { font-size: 36px; display: block; margin-bottom: 12px; }

  /* Animations */
  @keyframes popIn {
    from { opacity: 0; transform: scale(0.94) translateY(8px); }
    to   { opacity: 1; transform: scale(1) translateY(0); }
  }
  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(8px); }
    to   { opacity: 1; transform: translateY(0); }
  }
</style>
</head>
<body>
<div class="container">
  <div class="meta-row" id="meta-row"></div>
  <div class="title-block">
    <h1>Leaderboard</h1>
    <p class="title-sub">Weekly Rankings</p>
  </div>
  <div id="content">
    <p class="status"><span class="emoji">‚è≥</span>Loading results‚Ä¶</p>
  </div>
</div>

<script>
  const MEDALS = [
    { cls: 'gold',   emoji: 'ü•á', label: '1st Place' },
    { cls: 'silver', emoji: 'ü•à', label: '2nd Place' },
    { cls: 'bronze', emoji: 'ü•â', label: '3rd Place' },
  ];

  function parseCSV(text) {
    const lines = text.trim().split('\n').filter(l => l.trim());
    if (lines.length < 2) return [];
    const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
    return lines.slice(1).map(line => {
      const cols = [];
      let cur = '', inQ = false;
      for (const ch of line) {
        if (ch === '"') inQ = !inQ;
        else if (ch === ',' && !inQ) { cols.push(cur.trim()); cur = ''; }
        else cur += ch;
      }
      cols.push(cur.trim());
      const obj = {};
      headers.forEach((h, i) => obj[h] = (cols[i] || '').replace(/"/g, ''));
      return obj;
    });
  }

  function makeTag(label, value) {
    if (!value) return '';
    return `<div class="tag">${label} <span>${value}</span></div>`;
  }

  function render(rows) {
    if (!rows.length) {
      document.getElementById('content').innerHTML =
        '<p class="status"><span class="emoji">ü§î</span>No data found in CSV.</p>';
      return;
    }

    const first   = rows[0];
    const edition = first['Edition'] || '';
    const qm      = first['QM Name'] || '';
    const date    = first['Date']    || '';

    // Meta tags
    const metaRow = document.getElementById('meta-row');
    metaRow.innerHTML =
      makeTag('Edition', edition) +
      makeTag('QM', qm) +
      makeTag('üìÖ', date);

    // Top 3
    const top3 = rows.slice(0, 3);
    const rest  = rows.slice(3);

    let html = '<div class="top3">';
    top3.forEach((row, i) => {
      const m = MEDALS[i];
      html += `
        <div class="medal-card ${m.cls}">
          <span class="medal-emoji">${m.emoji}</span>
          <div class="medal-info">
            <div class="medal-name">${row['Participant'] || '‚Äî'}</div>
            <div class="medal-rank-label">${m.label}</div>
          </div>
          <span class="medal-score">${row['Score'] || ''}</span>
        </div>`;
    });
    html += '</div>';

    if (rest.length) {
      html += '<div class="rest-list">';
      rest.forEach((row, i) => {
        const delay = (i + 3) * 0.05;
        html += `
          <div class="rest-row" style="animation-delay:${delay}s">
            <span class="rest-rank">${row['Rank'] || i + 4}</span>
            <span class="rest-name">${row['Participant'] || '‚Äî'}</span>
            <span class="rest-score">${row['Score'] || ''}</span>
          </div>`;
      });
      html += '</div>';
    }

    document.getElementById('content').innerHTML = html;
  }

  fetch('data.csv?' + Date.now())
    .then(r => {
      if (!r.ok) throw new Error('CSV not found');
      return r.text();
    })
    .then(text => render(parseCSV(text)))
    .catch(() => {
      document.getElementById('content').innerHTML = `
        <p class="status">
          <span class="emoji">üì≠</span>
          No leaderboard data found.<br>
          <small>Make sure <strong>data.csv</strong> is in the same folder as this file.</small>
        </p>`;
    });
</script>
</body>
</html>
